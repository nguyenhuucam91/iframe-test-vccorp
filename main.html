<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Webpack App</title>
    </head>
    <body>
        <script src="./dist/main.js"></script>
        <script>     
            for (let i = 1; i <= 100; i++) {
                let heading = document.createElement('h3')
                let cvs = document.createElement('canvas')
                cvs.setAttribute('id', `chartjs-bar${i}-canvas`)
                heading.textContent = `Chart no:${i}`
                document.body.appendChild(heading)
                document.body.appendChild(cvs)
            }

            //lazy loading
            const intersectionObserver = new IntersectionObserver(entries => entries.forEach(entry => {
                const target = entry.target
                if (entry.isIntersecting && !target.getAttribute('data-show')) {
                    let chartJs = ChartBar.init();
                    const dataIndex = target.getAttribute('data-index')
                    target.setAttribute('data-show', true)
                    chartJs.apiUrl = `http://ec2-3-81-181-4.compute-1.amazonaws.com:3000/api/chartjs-barchart`
                    ChartBar.drawAt(chartJs, `chartjs-bar${dataIndex}-canvas`)
                }
            }))

            document.querySelectorAll('canvas').forEach((item,index) => {
                item.setAttribute('data-index', index+1)
                intersectionObserver.observe(item)
            })

        </script>
    </body>
    
</html>
